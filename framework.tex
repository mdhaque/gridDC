\section{Framework for smart placement}
\label{sec:framework}

The previous section highlights that placing data centers and wind
farms has obvious impact on the grid trasmission network system. Thus,
when a service provider is looking for best locations to estabish a
network of green data centers, the grid operational cost should also
be included as one of the most important factors into
consideration. Another observation is that co-location of the green
data center and the green energy plant seems not always be the best
choice. In this case, we try to study how to seek the best locations
for both the data center and the green energy plant, which are
designed to be connected to the same grid network.

By grid-aware placement, we attempt to efficiently select a set of locations for one or more data centers to support a given amount of computational power, as well as one or more green power plants (e.g. solar, wind or others) to provide a given power capacity. The main goal is to minimize the overall cost for data centers, green power plants and also the grid network operation. The next subsections defines some important parameters in the selection procedure. Then, the cost model and the entire optimization problem will be formulated and described.

\subsection{Parameters for the placement framework}

Table \ref{tab:par_setting} gives all of the parameters defined in our framework.  These parameters relate to costs, revenue and losses over different geographical locations. We generally classify them into three categories: data-center-related, renewable-related and grid-related.

\subsubsection{Data-center-related costs} Given a target capacity of how large a data center is planned to build, we can calculate the capital cost first. The capital cost of a data center at location $l$, denoted as $DC\_CAPcost(l)$, can be broken down into land cost ($DC\_landCost(l)$), building cost ($DC\_buildingCost(l)$) and hardware cost($DC\_hwCost(l)$). Land cost can be computed by land price at that location and the accommodated data center capacity. Building cost depends on the maximum capacity of the data center, too. Hardware cost contains both server cost and switch cost, which can be computed given the total capacity of the data center. Besides, hardware cost also includes costs for building lines connecting the data center to the Internet backbone and the transmission grid, denoted as $costLineNet(l)$ and $costLineGrid(l)$ here respectively. We assume them independent of the data center size, but dependent on the location $l$ of the data center.

Besides capital costs, operating and managing a data center also incurs operational cost, including costs for using the network bandwidth and the electricity from the power grid. We denote them as $DC\_netCost(l)$ and $DC\_energyCost(l)$ respectively, which both depend on the location $l$ of the data center. Furthermore, the energy cost for the data center is also related to the varying demands of the data center workload over different time period, denoted as $demand(l,t)$ hereafter.

\subsubsection{Renewable-related costs} The costs for building and running a renewable power plant also include capital costs and operation costs. The capital cost of a type $r$ plant at location $l$, denoted as $RE\_CAPcost(l,r)$, can be broken down into land cost ($RE\_landCost(l,r)$), building cost ($RE\_buildCost(l,r)$) and line cost ($costLineNet(l)$) for connecting to the transmission grid. Specially, if we are also building a data center in the same location, the connection line to the grid could be shared by the plant, and in this case the line cost could be saved. Similarly, the land cost for renewable power plant depends on the needed area and the land price at that location. The building cost mainly depends on the desired capacity of the plant.

Regarding operational costs, we assume that the human and labor costs for maintenance and operation are same over different locations. Thus, by operating the renewable power plant, we only consider the possible revenue it could bring by generating electricity power and transmitting power to the grid. Here, we regard the revenue as a negative cost for the power plant, denoted as $RE\_OPrev(l,r)$, which is closely related to the power generation efficiency at the location and the energy selling price there.

\subsubsection{Grid-related costs} When connecting the data centers and the renewable energy plants to the utility grid, we are adding both generation and consumption components into the network. This will change the power flow of the whole network, and thus the total losses of the transmission network will be different. Thus, the transmission loss ($transLoss(t)$) will be affected by the generating and consuming power amount of data centers and renewable plants, and also the buses they are connected to, as we showed in Section \ref{sec:quantify}.

%Besides, distributing power to the end-users on the grid will also incur losses. Here we only consider the additional distribution losses for delivering power to the data centers, denoted as $distLoss(t)$. Then the grid costs include both transmission losses and distribution losses in our framework.

On the other hand, during the transmission process the line capacity might be violated if the power flow exceeds the limit. We use $numLineVio(t)$ and $numVolVio(t)$ to denote the number of line capacity violations and voltage violations during power transmission. The grid operator will try to avoid such violations when operating the power grid system.

\begin{table}[ht]
\caption{Parameters for placement framework. Each location $l$ is a possible location from the set $\mathcal{L}$, and each $t$ denotes a time epoch during a time period $T$. Each $r$ is a type of renewable energy from the set $\mathcal{R}$.}
\begin{center}
\begin{tabular}{|l|p{1.7in}|r|}
\hline
\textbf{Symbol} & \textbf{Meaning} & \textbf{Unit}\\
\hline
$dcCapacity$ & desired power capacity for computing in DC & kW \\
$wfCapacity$ & desired power production capacity of wind farm & kW \\
\hline \hline
$pLand(l)$ & land price at $l$ & \$/m$^2$ \\
\hline \hline
$PUE(l,t)$ & PUE at $l$ during $t$ & \\
$maxPUE(l)$ & maximum PUE at $l$ & \\
$dcArea$ & land area needed per kW of DC capacity &  m$^2$/kW \\
$cLinePow(l)$ & cost to layout power line from $l$ to the closest power plant & \$ \\
$cLineNet(l)$ & cost to layout optical fiber from $l$ to closest network backbone & \$ \\
$pBuildDC(c)$ & price of building a datacenter with $c$ power capacity & \$/kW \\
$serverPow$ & server peak power demand & W \\
$switchPow$ & switch peak power demand & W \\
$servsPerSwitch$ & number of servers per switch & servs/switch \\
$pServer$ & price of a server &  \$/server \\
$pSwitch$ & price of a network switch & \$/switch \\
$pNetBWServ$ & cost of external network bandwidth per server & \$/serv-month\\
$pEnergy(l)$ & grid electricity price at $l$ & \$/kWh \\
$powDemand(t)$ & avg computing power demand of DC during $t$ &  kW \\
\hline \hline
$\beta(l,t)$ & avg generation efficiency of wind energy at $l$ during $t$ &  \%  \\
$wfArea$ & land area needed per kW wind energy & \$/m$^2$ \\
$pBuildWF$ & price of building a wind power plant & \$/kW \\
%$avgEff(l)$ & avg generation efficiency of wind energy at $l$ & \% \\
$revEnergy(l)$ & revenue for selling wind energy to grid at $l$ & \$/kWh \\
\hline \hline
$transLoss(t)$  & avg transmission loss in grid during $t$ & kW \\
%$disLoss(t)$ & the losses for distributing power to data center during time epoch $t$ & kW \\
$pGridLoss$ & the price for transimission losses per kWh & \$/kWh \\
%$numLineVio(t)$  & the number of line capacity violation during time epoch $t$   &  \#  \\
%$numVolVio(t)$  & the number of voltage level violation during time epoch $t$  &  \#  \\
\hline
\end{tabular}
\label{tab:par_setting}
\end{center}
\end{table}


\subsection{Optimization problem formulation}
Using the parameters shown in Table \ref{tab:par_setting}, we can formulate the optimization problem as shown in Figure~\ref{fig:optimization}. The problem is set up from the perspective of both IT company and the grid operator, who want to collaborate for building up green datacenters, with the purpose of minimizing the summarized cost including data center cost, green power plant cost and the grid cost.

Denote $\mathcal{L}$ as the set of all candidate locations, $\mathcal{T}$ as the set of all time epochs, $\mathcal{R}$ as the set of all types of renewable energy. The input of the optimization problem is listed as follows:
(1) the total computational capacity of all the data centers to set up, denoted as $CapacityDC$;
(2) the parameters of each location in $\mathcal{L}$ during each time epoch in $\mathcal{T}$ such as prices, PUE (Power Utilization Efficiency), demand, power generation efficiency and so on;
(3) the minimum availability constraint for the data center network. (\xynote{to limit the number of data centers})
The outputs of the problem is the lowest cost found and the corresponding locations for data centers and renewable power plant, as well as the capacity provisioned at each location for data centers or green power plants (if any).

Equation 1 in Fig.\ref{fig:optimization} shows the optimization objective of our defined problem, i.e. $TotalCost$, where $DC(l)$ and $RE(l,r)$ are booleans indicating whether to place a data center or power plant of type $r$ at location $l$. $DC\_Cost(l)$ , $RE\_Cost(l,r)$ and $Grid\_Cost$ represent the cost for data centers, renewable plants and the power grid system respectively.

\begin{figure*}
\begin{eqnarray}
	totalCost & = & dcCost + wfCost + energyCost \\
	dcCost & = & dcCAPEX + dcOPEX \\
        dcCAPEX & = & dcLandCost + dcBuildCost + dcITCost \\
        dcOPEX & = & dcNetCost + dcEnergyCost \\
        dcLandCost & = & pLand(d) \cdot dcArea \cdot dcCapacity \\
        dcBuildCost & = & dcTotalPow \cdot pBuildDC(dcTotalPow) +
            cLinePow(d) + cLineNet(d) \\
        dcTotalPow & = & dcCapacity \cdot maxPUE(d) \\
        dcITCost & = & nServers \cdot pServer + nSwitches \cdot
            pSwitch \\
        nServers & = & dcCapacity / (serverPow + switchPow / serversPerSwitch)\\
        nSwitches & = & nServers / servsPerSwitch\\
        dcNetCost & = & nServers \cdot pNetBWServ \\
        dcEnergyCost & = & \sum_{t \in T} {|t| \cdot powDemand(t) \cdot pEnergy(d) } \\
 	wfCost & = & wfCAPEX - wfRev  \\
        wfCAPEX & = & wfLandCost + wfBuildCost \\
        wfLandCost & = & pLand(w) \cdot wfArea \cdot wfCapacity \\
        wfBuildCost & = & pBuildWF \cdot wfCapicity + cLinePow(w) \\
        wfRev & = & revEnergy(w) \cdot  \sum_{t \in T}{ |t| \cdot
            \beta(w,t) \cdot wfCapicity } \\
        gridCost & = & pGridLoss \cdot \sum_{t \in T}{ |t| \cdot transLoss(t)} \\% + disLoss(t))}\\
\end{eqnarray}
\caption{Optimization framework.}
\label{fig:optimization}
\end{figure*}

The overall cost should be optimized under the constraints, which are listed in Figure~\ref{fig:constraints}. Equation 21-23 show the constraints of the provisioned capacity for data centers. Equation 24 means that the provisioned capacity for renewable energy plants are determined by the total power demand from the data centers. This constraint is added indicating that the power generation and consumption added to the grid should be balanced from the perspective of the grid system. Furthermore, Equation 26
is a strict limitation for keeping the grid out of any violations at any given time $t$, since we assume the grid reliability is crucial and must be guaranteed.

\begin{figure*} [ht]
\begin{small}
\centering
\begin{eqnarray}
\forall_{l \in \mathcal{L}}, capDC(l) \leq DC(l) \cdot CapacityDC
&\Rightarrow& \text{capacity of data center at $l$ should be zero when $DC(l)$ is 0} \\
\sum_{l\in \mathcal{L}}{DC(l)\cdot capDC(l)} = CapacityDC
&\Rightarrow& \text{total capacity of built data centers should meet the requirement} \\
\forall_{t \in T}, demand(l,t) \leq capDC(l)
&\Rightarrow& \text{power demand of the data center should not exceed its capacity} \\
%\forall_{l \in \mathcal{L},r\in \mathcal{R}}, capRE(l,r) \leq RE(l,r) \cdot CapacityRE  & \Rightarrow &
%\text{capacity of type $r$ plant at $l$ should be zero if $RE(l,r)$ is 0} \\
%\sum_{l \in \mathcal{L},r \in \mathcal{R}}{RE(l,r) \cdot capRE(l,r)} = CapacityRE & \Rightarrow &
%\text{total capacity of power plant should meet the requirement}\\
\begin{split}
\sum_{l \in \mathcal{L},r \in \mathcal{R}}{ RE(l,r) \cdot capRE(l,r) \cdot avg\textit{Eff}(l,r) } = \\
\sum_{t \in T, l\in \mathcal{L}}{DC(l) \cdot demand(l,t)\cdot PUE(l,t)}
\end{split}
&\Rightarrow &\text{the generated green energy should be balanced with consumption} \\
\forall_{t \in T}, 0 \leq \textit{eff}RE(r,l,t) < 1
&\Rightarrow&  \text{efficiency of power plant should be between $[0,1)$} \\
\forall_{t \in T}, numLineVio(t)=0, numVolVio(t)=0
&\Rightarrow& \text{No violations in each time epoch}
\end{eqnarray}
\end{small}
\caption{Optimization constraints.}
\label{fig:constraints}
\end{figure*}

\subsection{Optimizing approaches}
\subsubsection{Semi Brute force}
A time-consuming approach is to generate all of the possible combinations for data centers and renewable energy plants. However, it is not possible to generate all kinds of capacity provisioning amounts since it's not discrete. Thus, we generate combinations of locations first, and then evenly distribute the total capacity to all of the candidate locations selected. By testing these generated configurations, the approach returns the best one with the lowest total cost. This approach still could be very exhaustive, which needs extremely long time for execution.

\subsubsection{Heuristic searching}

\xynote{TO DO SOME WORK...}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "paper"
%%% End:
